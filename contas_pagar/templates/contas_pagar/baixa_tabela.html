
{% extends "base.html" %}

{% block content %}

<div class="card shadow-sm">
    <div class="card-header bg-success text-white">
        <h3 class="card-title mb-0">
            <i class="fa fa-money-bill"></i> Baixa de Contas Selecionadas
        </h3>
    </div>

    <form method="POST" action="{% url 'contas_pagar_baixa_confirmar' %}">
        {% csrf_token %}

        <div class="table-responsive">
        <table class="table table-bordered table-striped mt-3">
            <thead>
                <tr>
                    <th>Descrição</th>
                    <th>Fornecedor</th>
                    <th>Valor da Conta</th>
                    <th>Data Pagamento</th>
                    <th>Valor Pago</th>
                </tr>
            </thead>
            <tbody>
                {% for conta in contas %}
                <tr>
                    <td>{{ conta.descricao }}</td>
                    <td>{{ conta.fornecedor }}</td>
                    <td>R$ {{ conta.valor }}</td>

                    <td>
                           <input type="date"
                               name="data_pagamento_{{ conta.id }}"
                               class="form-control pagamento-data"
                               value="{{ hoje }}">
                    </td>

                    <td>
                           <input type="text"
                               name="valor_pago_{{ conta.id }}"
                               class="form-control money valor-pago"
                               value="{{ conta.valor }}">
                    </td>

                    <input type="hidden" name="contas" value="{{ conta.id }}">
                </tr>
                {% endfor %}
            </tbody>
        </table>
        </div>

        <div class="card-footer text-right">
            <button class="btn btn-success">
                <i class="fa fa-check"></i> Confirmar Baixa
            </button>

            <a href="{% url 'contas_pagar_lista' %}" class="btn btn-secondary">
                Cancelar
            </a>
        </div>
    </form>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.16/jquery.mask.min.js"></script>
<script>
function formatTodayForDateInput() {
    var today = new Date();
    var year = today.getFullYear();
    var month = String(today.getMonth() + 1).padStart(2, '0');
    var day = String(today.getDate()).padStart(2, '0');
    return year + '-' + month + '-' + day;
}

$('.money').mask('000.000.000,00', {reverse: true});

var todayValue = formatTodayForDateInput();
$('.pagamento-data').each(function () {
    if (!this.value) {
        this.value = todayValue;
    }
});
</script>

<style>
.valor-pago {
    min-width: 140px;
    font-size: 1rem;
    padding: 0.5rem 0.75rem;
}
</style>

{% endblock %}